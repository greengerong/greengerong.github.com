
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <title>自定义控件---重写Listbox实现item图标变换和item点击事件 - 破狼 Blog</title>
    <meta name="author" content="破 狼"> 
    <meta name="description" content="自定义控件---重写Listbox实现item图标变换和item点击事件"> 
    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1"> 
    <link rel="canonical" href="http://greengerong.github.io/blog/2009/09/30/zi-ding-yi-kong-jian-zhong-xie-Listbox-shi-xian-item-tu-biao-bian-huan-he-item-dian-ji-shi-jian">
    <link href="/favicon.png" rel="icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/atom.xml" rel="alternate" title="破狼 Blog" type="application/atom+xml">
    <script src="/javascripts/modernizr-2.0.js"></script>
    <script src="//cdn.bootcss.com/jquery/1.9.1/jquery.min.js"></script>
    <script>
    !window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))
    </script>
    <script src="/javascripts/octopress.js" type="text/javascript"></script>
    <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
 

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">破狼 Blog</a></h1>
  
    <h2>Write less got more.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:greengerong.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">自定义控件---重写Listbox实现item图标变换和item点击事件</h1>
    
    
      <p class="meta">
        








  


<time datetime="2009-09-30T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://greengerong.github.io">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;博客开通有一阵了，就是没有时间写，遗憾啊。！
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这几天做了个排序的自定义控件，在listbox item里放是button 并支持图标的交替变换
效果如下： 博客开通有一阵了，就是没有时间写，遗憾啊。！</p>

<pre class='green'><code>  这几天做了个排序的自定义控件，在listbox item里放是button 并支持图标的交替变换
</code></pre>

<p>效果如下：
<img src="http://images.cnblogs.com/cnblogs_com/whitewolf/order.jpeg" alt="" /></p>

<p>把代码贴上：</p>

<pre class='green'><code>      1using System;
      2using System.Collections.Generic;
      3using System.Collections;
      4using System.Text;
      5using System.ComponentModel;
      6using System.Windows.Forms;
      7using System.Drawing;
      8using System.Drawing.Text;
      9using System.Data;
     10
     11namespace SQLAnalysis
     12{
     13    public class ListBoxEx : ListBox
     14    {
     15        public ListBoxEx()
     16        {
     17            this.DrawMode = DrawMode.OwnerDrawFixed;
     18            btnList = new List&lt;Button&gt;();
     19        }
     20        public override DrawMode DrawMode
     21        {
     22            get
     23            {
     24                return DrawMode.OwnerDrawFixed;
     25            }
     26            set
     27            {
     28                base.DrawMode = DrawMode.OwnerDrawFixed;
     29            }
     30        }
     31       
     32        protected override void OnResize(EventArgs e)
     33        {
     34            base.OnResize(e);
     35            this.Refresh();
     36        }
     37
     38
     39
     40
     41        public Button FindItemButton(int index)
     42        {
     43            
     44        // return this.Controls.Find(this.Name + "$ItemComboBox" + index.ToString(), true)[0];
     45            if (index &gt;= btnList.Count)
     46                return null;
     47            return btnList[index];
     48           
     49        }
     50
     51        /// &lt;summary&gt;
     52        /// 提供删除item项
     53        /// &lt;/summary&gt;
     54        /// &lt;param name="index"&gt;&lt;/param&gt;
     55        public void RemoveItem(int index)
     56        {
     57            this.Items.RemoveAt(index);
     58            btnList[index].Parent = null;
     59            btnList[index] = null;
     60            //btnList[index].Dispose();
     61            
     62            btnList.RemoveAt(index);
     63            this.Refresh();
     64        }
     65        /// &lt;summary&gt;
     66        /// 提供移动item项
     67        /// &lt;/summary&gt;
     68        /// &lt;param name="offset"&gt;&lt;/param&gt;
     69        public void MoveItem(int offset)
     70        {
     71            
     72            int index = this.SelectedIndex + offset;
     73            if (index &gt; -1 &amp;&amp; index &lt; this.Items.Count)
     74            {
     75                int oldSelectedIndex = this.SelectedIndex;
     76                Object item = this.SelectedItem;
     77                this.Items.RemoveAt(oldSelectedIndex);
     78                this.Items.Insert(index, item);
     79                Button btn = btnList[oldSelectedIndex];
     80                btnList.RemoveAt(oldSelectedIndex);
     81                btnList.Insert(index, btn);
     82
     83                this.Refresh();
     84            }
     85            else
     86            {
     87                MessageBox.Show("不是可用的移动矢量");
     88
     89            }
     90
     91        }
     92
     93        private ToggleItem GetNexttoggleItem(ToggleItem tog)
     94        {
     95            int index = -1;
     96            for (int i = 0; i &lt; ToggleItemList.Count; i++)
     97            {
     98                ToggleItem item =(ToggleItem)ToggleItemList[i];
     99                if (item.Tag == tog.Tag)
    100                {
    101                    index = i;
    102                    break;
    103                }
    104            }
    105            return ((ToggleItem)ToggleItemList[(index + 1) % ToggleItemList.Count]);
    106        }
    107        private List&lt;ToggleItem&gt; toggleItemList ;//List&lt;ToggleItem&gt; toggleItemList = new List&lt;ToggleItem&gt;();
    108        [Bindable(false), Browsable(false)]
    109        [DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden)]   
    110        public List&lt;ToggleItem&gt; ToggleItemList
    111        {
    112            get
    113            {
    114                if (toggleItemList == null)
    115                    toggleItemList = new List&lt;ToggleItem&gt;();
    116                return toggleItemList;
    117            }
    118
    119            set
    120            {
    121                if (toggleItemList == null)
    122                    toggleItemList = new List&lt;ToggleItem&gt;();
    123                toggleItemList = value;
    124            }
    125        }
    126
    127        //主要重写事件
    128        protected override void OnDrawItem(DrawItemEventArgs e)
    129        {
    130            this.DrawMode = DrawMode.OwnerDrawFixed;
    131            this.ItemHeight = 22;
    132            e.DrawBackground();
    133            e.DrawFocusRectangle();
    134            Brush myBrush = Brushes.Black;
    135            if (e.Index &gt; -1 &amp;&amp; e.Index &lt; this.Items.Count)
    136            {
    137                string drawString = (e.Index + 1)+ " " + this.Items[e.Index].ToString();
    138                
    139
    140                e.Graphics.DrawString(drawString, e.Font, new SolidBrush(e.ForeColor), e.Bounds, 
    141
    142StringFormat.GenericDefault);
    143                AddButtonToItem(e);
    144            }
    145            base.OnDrawItem(e);
    146
    147        }
    148
    149        private List&lt;Button&gt; btnList = null;
    150        protected void AddButtonToItem(DrawItemEventArgs e)
    151        {
    152            if (btnList.Count &lt;= e.Index)
    153            {
    154                btnList.Add(new Button());
    155                Button btn = btnList[e.Index];
    156                btn.BackColor = System.Drawing.Color.LightSkyBlue ;
    157                btn.Name = this.Name + "$ItemButton" + e.Index.ToString();
    158                btn.Width = 20;
    159                btn.Height = 20;
    160                btn.ImageAlign = ContentAlignment.MiddleCenter;
    161                btn.TextImageRelation = TextImageRelation.ImageAboveText;
    162                if (toggleItemList.Count &gt; 0)
    163                {
    164                    
    165                    btn.BackgroundImage = ((ToggleItem)toggleItemList[0]).BGImage;
    166                    //btn.Width = toggleItemList[0].BGImage.Width;
    167                    //btn.Height = toggleItemList[0].BGImage.Height;
    168                    btn.Tag = ((ToggleItem)toggleItemList[0]).Tag;
    169                }
    170                btn.Parent = this;
    171                btn.Click += new EventHandler(ItemButtonClickHandler);
    172            }
    173            Button bt = btnList[e.Index];
    174            bt.Left = this.Width - bt.Width - 20;
    175            bt.Top = e.Bounds.Top;
    176           
    177        }
    178        /// &lt;summary&gt;
    179        /// item button双击事件；
    180        /// &lt;/summary&gt;
    181        /// &lt;param name="sender"&gt;&lt;/param&gt;
    182        /// &lt;param name="e"&gt;&lt;/param&gt;
    183        protected void ItemButtonClickHandler(object sender, EventArgs e)
    184        {
    185            int index = -1;
    186            if (sender is Button)
    187                index = this.IndexFromPoint(((Button)sender).Location);
    188
    189            if (index == -1)
    190                return;
    191
    192            Button btn = sender as Button;
    193            ToggleItem togold = new ToggleItem((string)btn.Tag, btn.BackgroundImage);
    194            ToggleItem tognew = this.GetNexttoggleItem(togold);
    195            //btn.Width = tognew.BGImage.Width;
    196            //btn.Height = tognew.BGImage.Height;
    197            btn.BackgroundImage = tognew.BGImage;
    198           
    199            btn.Tag = tognew.Tag;
    200
    201            ItemEventHandler handler = (ItemEventHandler)Events[ItemLabelClickObj];
    202            if (handler != null)
    203            {   
    204                
    205                handler(sender, new ItemButtonClickEventArgs(index)); ;
    206            }
    207        }
    208
    209       
    210
    211        
    243    }
    244    [Serializable]
    245    public class ToggleItem
    246    {
    247        private string tag;
    248        private Image bgImage;
    249        public ToggleItem()
    250        {
    251        }
    252        public ToggleItem(string tag, Image bg)
    253       {
    254           this.tag = tag;
    255           this.bgImage = bg;
    256       }
    257       public string Tag
    258       {
    259            get
    260            {
    261                return tag;
    262           }
    263           set
    264           {
    265                tag = value;
    266            }
    267        }
    268
    269      public Image BGImage
    270        {
    271           get
    272           {
    273               return bgImage;
    274           }
    275
    276           set
    277           {
    278               bgImage = value;
    279
    280           }
    281       }
    282
    283    }
    284
    285}    
</code></pre>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本文通过程序<a href="https://github.com/greengerong/cnblogs-blogs2markdown" title="cnblogs-blogs2markdown">cnblogs-blogs2markdown</a>转换的,如质量有问题<a href="http://www.cnblogs.com/whitewolf/archive/2009/09/30/1577101.html" title="原文首发">原文首发请看这里</a></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">破 狼</span></span>

      








  


<time datetime="2009-09-30T00:00:00+08:00" pubdate data-updated="true"></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/cnblogs/'>cnblogs</a>
  
</span>


    </p>
    
      <!-- <div class="sharing">
  
  
  
</div>
 -->
<!-- JiaThis Button BEGIN -->
<div class="jiathis_style_32x32">
  <a class="jiathis_button_qzone"></a>
  <a class="jiathis_button_tsina"></a>
  <a class="jiathis_button_tqq"></a>
  <a class="jiathis_button_weixin"></a>
  <a class="jiathis_button_renren"></a>
  <a href="http://www.jiathis.com/share?uid=1893648" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
  <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript">
var jiathis_config = {data_track_clickback:'true'};
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1390461225091792" charset="utf-8"></script>
<!-- JiaThis Button END -->
    
    <p class="meta">
      
      
        <a class="basic-alignment right" href="/blog/2009/10/12/fang-listBox-xie-liao-yi-ge-Control-kong-jian-wei-item-di-lie-biao-ji-he/" title="Next Post: 仿listBox写了一个Control控件为item的列表集合">仿listBox写了一个Control控件为item的列表集合 &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><div id="disqus_thread"></div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'greengerong'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a></div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>破 狼</h1>
  <p>    那一夜，我听了一宿梵唱，不为参悟，只为寻你的一丝气息。 那一月，我转过所有经轮，不为超度，只为触摸你的指纹。 那一年，我磕长头拥抱尘埃，不为朝佛，只为贴着了你的温暖。 那一世，我翻遍十万大山，不为修来世，只为路中能与你相遇。 那一瞬，我飞升成仙，不为长生，只为佑你平安喜乐。<a href="http://greengerong.github.io/blog/2009/12/24/cang-yang-jia-cuo-na-yi-tian-na-yi-yue-na-yi-nian-na-yi-shi/">《那一天，那一月，那一年，那一世》--仓央嘉措。</a></p>
</section>
<section>
  <p style="align: center"><a href="http://www.amazingcounters.com"><img border="0" src="http://cc.amazingcounters.com/counter.php?i=3158890&amp;c=9476983" alt="count web site visits"/></a></p>
</section>
<section>
    <h1>博客友情链接</h1>
    <ul>
        <li><a href="http://www.cnblogs.com/whitewolf/">博客园-破狼</a></li>
    </ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/09/28/duo-cai-de-consolexin-wan-fa/">多彩的Console打印新玩法</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/24/es7-javascript-decorators/">细说ES7 JavaScript Decorators</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/23/es7-zhi-decorators-shi-xian-aopshi-li/">ES7之Decorators实现AOP示例</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/22/coffeescript-shi-xian-python-zhuang-huang-qi/">CoffeeScript实现Python装潢器</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/19/verlet-js-javascript-wu-li-yin-qing/">Verlet-js JavaScript 物理引擎</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/15/html5te-shu-su-ji-tu/">HTML5特性速记图</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/12/coffeescriptban-ngcomponentfeng-zhuang/">Angular遇上CoffeeScript - NgComponent封装</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/09/kuo-zhan-bootstrap-tooltipcha-jian-shi-qi-ke-jiao-hu/">扩展Bootstrap Tooltip插件使其可交互</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/greengerong">@greengerong</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'greengerong',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - 破 狼 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  


<!-- UY BEGIN -->
<div id="uyan_frame"></div>
<script type="text/javascript" src="http://v2.uyan.cc/code/uyan.js?uid=1893648"></script>
<!-- UY END -->











</body>
</html>
