
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <title>破狼 Blog</title>
    <meta name="author" content="破 狼"> 
    <meta name="description" content="如果您需要编辑模板页，默认的FCK设置是会去掉&lt;HTML&gt;&lt;/HTML&gt;&lt;BODY&gt; &lt;/BODY&gt;标签，而且会给你加上&lt;P&gt;&lt;/P&gt;标签的，怎么办呢，只要设置一个小的 地方就可以了。在fckconfig里面有 &hellip;"> 
    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1"> 
    <link rel="canonical" href="http://greengerong.github.io/blog/page/14">
    <link href="/favicon.png" rel="icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/atom.xml" rel="alternate" title="破狼 Blog" type="application/atom+xml">
    <script src="/javascripts/modernizr-2.0.js"></script>
    <script src="//cdn.bootcss.com/jquery/1.9.1/jquery.min.js"></script>
    <script>
    !window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))
    </script>
    <script src="/javascripts/octopress.js" type="text/javascript"></script>
    <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
 

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">破狼 Blog</a></h1>
  
    <h2>Write less got more.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:greengerong.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/12/15/FCK-qu-diao-p-biao-qian-he-jia-Body-biao-qian/">FCK去掉p标签 和加Body标签</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-15T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2010/12/15/FCK-qu-diao-p-biao-qian-he-jia-Body-biao-qian/#disqus_thread"
             data-disqus-identifier="http://greengerong.github.io/blog/2010/12/15/FCK-qu-diao-p-biao-qian-he-jia-Body-biao-qian/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>如果您需要编辑模板页，默认的FCK设置是会去掉&lt;HTML&gt;&lt;/HTML&gt;&lt;BODY&gt;</p>

<p>&lt;/BODY&gt;标签，而且会给你加上&lt;P&gt;&lt;/P&gt;标签的，怎么办呢，只要设置一个小的</p>

<p>地方就可以了。在fckconfig里面有 FCKConfig.FullPage = false ;
改为 FCKConfig.FullPage = true
如果想去掉自动添加&lt;P&gt;的代码就可以在这里设置
默认是</p>

<pre class='green'><code>FCKConfig.EnterMode = 'p' ;   // p | div | br
FCKConfig.ShiftEnterMode = 'br' ; // p | div | br
</code></pre>

<p>改成</p>

<pre class='green'><code>FCKConfig.EnterMode = '' ;   // p | div | br
FCKConfig.ShiftEnterMode = 'br' ; // p | div | br   
</code></pre>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本文通过程序<a href="https://github.com/greengerong/cnblogs-blogs2markdown" title="cnblogs-blogs2markdown">cnblogs-blogs2markdown</a>转换的,如质量有问题<a href="http://www.cnblogs.com/whitewolf/archive/2010/12/15/1906959.html" title="原文首发">原文首发请看这里</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/12/13/wo-di-cheng-xu-ren-sheng-yu-yan-xue-xi-zhi-lu/">我的程序人生&#8211;语言学习之路</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-13T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2010/12/13/wo-di-cheng-xu-ren-sheng-yu-yan-xue-xi-zhi-lu/#disqus_thread"
             data-disqus-identifier="http://greengerong.github.io/blog/2010/12/13/wo-di-cheng-xu-ren-sheng-yu-yan-xue-xi-zhi-lu/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在这里总结一下我在语言学习之路。我是一个信息与计算科学的学习，属于应用数学，走上了程序员之路，回想起觉得有些诧异。我并不是科班出生的合格程序员。我走上这条道理也是一种偶然，或许该说是兴趣所致吧。在大学之前，我一个僻远山区的孩子，计算机这个东西碰都没有碰过得，记得高中会考时候连复制、新建这些简单操作都不知道的我，大学在第一个语言课C学习中感到了乐趣所在，在编写出每一个code，都能让我有一种自豪感。慢慢的我爱上的Code，又等到了两个老师的帮助，进入了某大企业实习。大二开始就在外边做项目，给我了许多程序基础理论和设计思想等方面的积累。使我的程序之路走的比较顺利，毕业时，虽然某些企业对我的经验有所怀疑。</p>

<p>&nbsp;&nbsp;&nbsp; 在大学语言的学习之路我学了好几门语言，在这里和大家一一分享下我的这条学习之路。</p>

<p>&nbsp;&nbsp;&nbsp; 按时间来说我接触的首先是c这门古老的语言，也是他带着我走上了这条程序之路。在刚学完C的时候我一个非科班的师弟（当时大一下期）在校程序大赛中拿的大奖，树立的我软件的梦想，虽然在毕业后有些徘徊，但是在学生期间对我的程序学习之路是很大的鼓励，当时我还学习的C的一些高级编程Socket等（现在已忘的差不多了），还参加了学校的单片机创新课题用C Show了一下，哈哈。下面是我当时的最后综合实验程序-多种排序集合：</p>

<pre class='green'><code> #include&lt;stdio.h&gt; 
        #define M  20

        void disp1(int *a,int n) 
        {    int i; 
        printf("\nsort before  :*****\n"); 
          for(i=1;i&lt;=n;i++) 
            printf(" %3d",a[i]); 
        }

        void disp2(int *a,int n) 
        { int i; 
          printf("\nsort after  :*****\n"); 
        for(i=1;i&lt;=n;i++) 
             printf(" %3d",a[i]); 
              a[0]=-1; 
        }

        void create(int *a,int *b,int  *n) 
        {int i; 
          printf("input the toall\n"); 
             scanf("%d",n); 
            for(i=1;i&lt;=*n;i++) 
            {  printf("input the %d\n",i); 
                scanf("%d",&amp;a[i]); 
                 b[i]=a[i]; 
              } 
           a[0]=b[0]=0; 
        }

        void  insertsort(int *a,int n) 
        { int i,j;

          for(i=2;i&lt;=n;i++) 
           {  a[0]=a[i]; 
             for(j=i-1;a[0]&lt;a[j];j--) 
                        a[j+1]=a[j]; 
                  a[j+1] =a[0]; 
            }

        }


        void xiersort(int *a,int n) 
        { int d[3]={5,3,1}; 
           int i,j,k=0;

           while(k&lt;3) 
        {  for(i=d[k]+1;i&lt;=n;i++) 
             {   a[0]=a[i]; 
                 for(j=i-d[k];j&gt;0&amp;&amp;a[j]&gt;a[0];j=j-d[k]) 
                        a[j+d[k]]=a[j]; 
                  a[j+d[k]]=a[0]; 
              } 
            k++; 
        }

        }


        void maopaosort(int *a,int n) 
        {  int i,j,change,t;

          for(i=1;i&lt;n;i++) 
           { change=0; 
               for(j=1;j&lt;=n-i;j++) 
                  if(a[j]&gt;a[j+1]) 
                      { t=a[j]; 
                         a[j]=a[j+1]; 
                          a[j+1]=t; 
                           change=1; 
                       }

               if(change==0) 
                           break; 
              } 
        }


        void quicksort(int *a,int t, int n) 
        {  int i=t,j=n;

          while(i&lt;j) 
        {   if(i&lt;j) 
            {   a[0]=a[i]; 
                 while(i&lt;j&amp;&amp;a[j]&gt;a[0]) 
                             j--; 
                 if(i&lt;j) 
                   {  a[i]=a[j]; 
                         i++; 
                     }

               while(i&lt;j&amp;&amp;a[i]&lt;a[0]) 
                             i++; 
                 if(i&lt;j) 
                   {  a[j]=a[i]; 
                         j--; 
                     } 
            } 
               a[i]=a[0]; 
             quicksort(a,1,i-1); 
             quicksort(a,i+1,n);

        } 
        }


        void jiandansort(int *a,int n) 
        { int i,j,t; 
          for(i=1;i&lt;n;i++) 
          { for(j=i+1;j&lt;=n;j++) 
               if(a[i]&gt;a[j]) 
               {  t=a[i]; 
                    a[i]=a[j]; 
                   a[j]=t; 
                } 
           } 
        }



        void main( ) 
        {int a[M+1],b[M+1],n=0,i; 
        char ch1='y',ch2; 
        create(a,b,&amp;n);

        while(ch1=='y'||ch1=='Y') 
        { printf("\n input 1---------  insert sort"); 
           printf("\n input 2---------  xi er sort"); 
           printf("\n input 3---------mao pao sort"); 
           printf("\n input 4---------  quick sort"); 
            printf("\n input 5--------  jian dan sort"); 
            printf("\n inputc(C)---------  creat"); 
            printf("\n input n(N)---------  exit\n");

            scanf("\n%c",&amp;ch2); 
             if(a[0]==-1) 
               for(i=1;i&lt;=n;i++) 
                 a[i]=b[i];

        switch(ch2) 
        { case  '1': disp1(a,n);     insertsort(a,n) ; 
                           disp2(a,n);      break; 
           case  '2': disp1(a,n);     xiersort(a,n); 
                            disp2(a,n);    break; 
           case  '3': disp2(a,n);     maopaosort(a,n); 
                           disp2(a,n);       break; 
           case  '4': disp1(a,n);    quicksort(a,1,n); 
                          disp2(a,n);      break; 
            case  '5':disp1(a,n);       jiandansort(a,n); 
                            disp2(a,n);     break; 
            case  'c': 
            case  'C':create(a,b,&amp;n);   break; 
            case  'n': 
            case  'N' :ch1='n'; 
        } 
        } 
        }
</code></pre>

<p> 现在看起代码是比较糟糕!</p>

<p>&nbsp; 接着我学习的汇编这门更古老的语言的，个人感觉汇编若只是说语法和学习，并不难。在这里也贴出我学习时候的一个打字游戏的小Code.</p>

<pre class='green'><code>    ;;;;任意掉落字符,按空格和ESC暂停并再ESC结束,空格继续;; 
    .model small 
    clear_screen macro op1,op2,op3,op4 ;清屏宏定义   
    push ax 
    push bx 
    push cx 
    push dx 
        mov ah,06h          
        mov al,00h 
        mov bh,06h 
        mov ch,op1 
        mov cl,op2 
        mov dh,op3 
        mov dl,op4 
        int 10h 
        mov ah,02h 
        mov bh,0h 
        mov dh,00h 
        mov dl,00h 
        int 10h 
    pop dx 
    pop cx 
    pop bx 
    pop ax 
    endm

    set  macro p1,p2,p3 ;;;设置光标并显示p1 
    push cx 
    mov ah,02h 
    mov bh,0h

    mov dx,p3 
    mov dh,p2 
    int 10h 
    mov ah,0ah 
    mov al,p1 
    mov cx,1 
    mov bl,12 
    int 10h 
    pop cx 
    endm

    delay macro;;;拖延时间 
    local sg1,sg2,nextdelay,nextdelay1 
    push cx 
    push dx 
    push  ax 
    mov dx,speed 
    mov cx,1000 
    sg1 : 
    sg2 : 
       loop sg2 
    dec dx 
    jnz sg2 
    mov ah,0bh 
    int 21h 
    cmp al,0h;;无字符可以读取 
    je nextdelay 
    mov ah,7 
    int 21h 
    cmp al,' ' 
    je calll 
    cmp al,1bh 
    jne nextdelay1 
    calll : 
    call justment 
      jmp  nextdelay 
    nextdelay1: 
    cmp al,letters[si] 
      jne  nextdelay 
      call disp 
    nextdelay: 
    pop ax 
    pop dx 
    pop  cx 
    endm

    menu  macro op1,op2,op3 ;菜单显示宏定义      
       mov ah,02h 
       mov bh,00h 
       mov dh,op1 
       mov dl,op2 
       int 10h 
       mov ah,09h 
       lea dx,op3 
       int 21h 
    endm


    .model 
    .stack 256 
    .data 
    letters db "jwmilzoeucgpravskntxhdyqfb" 
            db 'iytpkwnxlsvxrmofzhgaebudjq' 
            db 'nwimzoexrphysfqtvdcgljukdas' 
    count equ $-letters ;;79 
    menu0 db "Welcome to play !$"   
    menu1 db 'input enter to game!',0dh,0ah,'$' 
    menu2 db 'input space to halt!',0dh,0ah,'$' 
    menu3 db 'input esc to exit!',0dh,0ah,'$' 
    menu40 db 'this is agame which pritise keyin,',0dh,0ah,'$' 
    menu41    db ' when you are exit from the ' 
                     db 'game ,you will',0dh,0ah,'$' 
    menu42 db ' kown how much you can hit ',0dh,0ah,'$' 
    msg db 'choise speed:f--fast;s--slow;other character--orditional ! ' 
    msg0 db 'you hit:$' 
    msg1 db 'Help : space--- halt   Esc---home$' 
    speed dw  800 
    h dw ? 
    l  db ? 
    gs db 0 
    .code 
    mov ax,@data 
    mov ds,ax 
    menulist : 
    clear_screen 0d,00d,25d,79d  ;;24*80(0开始) 
    menu 07,20,menu0       ;菜单信息的宏调用 
             menu 09,20,menu1 
             menu 11,20,menu2 
             menu 13,20,menu3 
             menu 15,20,menu40 
             menu 17,22,menu41 
             menu 19,22,menu42 
    again: 
    mov ah,0 
    int 16h 
    cmp al,1bh 
      jne nextmain1 
    jmp overmain 
    nextmain1 : 
    cmp al,0dh 
    jne  again 
    clear_screen 0d,00d,25d,79d  ;;24*80(0开始) 
    call setspeed 
    clear_screen 0d,00d,25d,79d  ;;24*80(0开始) 
    menu 0,5,msg1;;help menu 
    mov dx,0 
    ag0: 
    call outdb 
    call rand 
    mov di,si 
    call rand 
      add di,si 
    shr di,1;;;列坐标 
    mov cx,1 
    call rand 
    push ax 
    mov ax,si 
      call rand 
      add si,ax 
      shr si,1;;;产生字符去两次的平均值 
    pop ax 
    ag : 
    mov h,di 
    mov l,cl 
    mov al,letters[si] 
    set al,cl,di 
      delay 
    dispag : 
    set ' ',cl,di 
      inc cx 
    cmp cx,23 
    je next 
    jmp ag 
    next : 
    inc dx 
    cmp dx,5 
    je  overmain 
    jmp ag0 
    overmain:


    call outdb 
    mov ah,4ch 
    int 21h

    ;;;;;; 
    rand proc 
    push ax 
    push bx 
    push cx 
    push dx 

    sti;允许中断1ah:0 
    mov ah,0 
    int 1ah 
    mov ax,dx 
    and  ah,0;;清除高6位 
    mov bl,count 
    div  bl 
    mov al,ah 
    mov ah,0 
    mov si,ax 
    pop dx 
    pop  cx 
    pop bx 
    pop ax 
    ret 
    rand endp 
    ;;;;;;;; 
    justment proc

    cmp al,' ' 
    call stop;;暂停

    ret 
    justment endp 
    ;;;;;;;;;;;;;;; 
    stop proc 
    ;;;;;;;;;;;;;;local agstop 
    agstop : 
    mov ah,0bh 
    int 21h 
    cmp al,0 
    je  agstop 
    mov ah,7 
    int 21h 
    cmp al,' ' 
    je overstop 
    cmp al,1bh 
    jne nextagstop1 
    jmp menulist 
    nextagstop1: 
    jmp agstop 
    overstop: 
    ret 
    stop endp

    ;;;; 
    disp proc 
    set ' ',l,h 
    inc gs 
    call ring

    call outdb 
    jmp ag0 
    ret 
    disp endp 
    ;;;;;;;;;; 
    outdb proc 
    push ax 
    push bx 
      push cx 
    push dx

    mov ah,02h 
       mov bh,0h 
       mov dh,0 
       mov dl,60 
       int 10h

    mov ah,9 
    mov dx,offset msg0 
    int 21h 
    mov al,gs

      mov ch,10 
    mov cl,0;记数 
    mov bh,0;;bh=0 
    agodb : 
      mov ah,0 
      div ch 
      mov bl,ah;;存余数入栈 
       add bl,'0' 
    push bx 
       inc cl 
       cmp al,0 
        jg agodb 
      mov ch,0

    agodb1 : 
    pop bx 
    mov dx,bx 
    mov ah,2 
    int 21h 
    loop agodb1

    ;;mov dl,0dh 
    ;; mov ah,2 
    ;;int 21h 
    ;; mov dl,0ah 
    ;; mov ah,2 
    ;;int 21h

    pop dx 
    pop cx 
    pop bx 
    pop ax 
    ret 
    outdb endp 
    ;;;;;;;;;;;;;; 
    setspeed proc 
    push ax 
    menu 15,5,msg 
    mov  ah,1h 
    int 21h 
    cmp al,'f' 
    je nextspeed1 
    cmp al,'s' 
      jne nextspeed2 
    mov speed,1000 
    jmp  nextspeed2 
    nextspeed1 : 
    mov speed,500 
    nextspeed2: 
    pop ax 
      ret 
    setspeed endp

    ;;;;;;;;;;;;; 
    ring proc 
    push ax 
    push cx 
    push dx

    mov cx,3 
    ringed : 
    mov ah,02h 
    mov dl,07h 
    int 21h 
    clear_screen 1d,00d,25d,79d  ;;24*80(0开始) 
    loop ringed 
    pop dx 
    pop cx 
    pop ax 
    ret 
    ring endp

    end
</code></pre>

<p>&nbsp;&nbsp;&nbsp;&nbsp; 紧接着遇见的上面说的两位老师他们用的是c#语言，和他们一起做些小开发，所以我也走上了,NET之路，刚开始做了几个Web的开发。其中一个老师是某企业的架构师，所以在他的帮助和介绍下，我和他一同学习并进入企业实习，做了一些Winform的开发，平时空闲的时候就在老师的指导下位他的快速开发平台，添加一些新东西，改进等工作。那时虽然辛苦一些，但是过的挺充实的，读书的时候还有比较好的外快，挺兴奋的。同时，我也没有拉下一门课程学习，虽然经常不去上课，老师们都挺支持和理解我的，期末时考试也考得很好。在这里我感谢每一位关心和支持我的老师们，你们辛苦了。</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp; 在.NET平台上C#肯定和必备的，在这里也挑不出来典型的code展示，同时在,NET平台的唯一函数式编程语言出来后，我带着多函数式思想的理解的心情，学习了这门语言，第一次感觉到函数式编程的魅力所在，并不是写一些code（博客里贴出了两篇<a href="http://www.cnblogs.com/whitewolf/archive/2010/11/29/1891322.html"><font color="#6699cc">F#初试（2）</font></a> 、<a href="http://www.cnblogs.com/whitewolf/archive/2010/07/14/1777408.html"><font color="#6699cc">F#初试&mdash;打印目录文件树</font></a>）。&nbsp;&nbsp;&nbsp;</p>

<p>&nbsp;&nbsp;&nbsp; 后来我也学习了我们的面向对象的语言C++，Java，MathLab（对于数学专业的尅定是必须的，呵呵）。在c++学习时候学的感觉挺好的，但是到了准备学习MFC，看着他的函数名称等一大堆的字母，比起C#是难，这是我的c#也学得有一定基础，所以我放弃了。对于Java我还是很指着的学习了一段时间，会Java Bean，model1的开发，但只能说是基础的，当时让我苦恼的是Java一大堆的东西需要自己手工配置，还有就是那个IDE的智能提示速度让人还郁闷.绕了一圈还是继续我的.NET之路，因为在外边我所做的都是基于c# WinForm的开发，它有一个优秀的类库和IDE支持。虽然我没有继续Java，c++的学习，但是我觉得他们也是很优秀的，并不比c#差。对于一个程序不管你是c#，Java编写的能满足客户需求就是一个好的code，程序只是各种语言抒写的艺术，不该存在语言之争。毕业之时我希望走的c的编程，但是没有这样的基于，还有就是.NET已经具有了一定基础，更好找工作些，如果有机会我觉得我还想走c的编程，前提是工资与我.NET持平，呵呵。</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp; 本想写的好些，但是我的文字功底太差了，构思的时候挺多的，一到写的时候感觉痛困难的，需要多多练习。请大家多多指教。</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp; 随笔收尾了，虽然现实与梦想存在差距，但是我的程序之路然在继续&#8230;</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本文通过程序<a href="https://github.com/greengerong/cnblogs-blogs2markdown" title="cnblogs-blogs2markdown">cnblogs-blogs2markdown</a>转换的,如质量有问题<a href="http://www.cnblogs.com/whitewolf/archive/2010/12/13/1904361.html" title="原文首发">原文首发请看这里</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/11/29/F-chu-shi-2/">F#初试（2）</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-29T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2010/11/29/F-chu-shi-2/#disqus_thread"
             data-disqus-identifier="http://greengerong.github.io/blog/2010/11/29/F-chu-shi-2/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>&nbsp; 这里只是几个f#简单的算法应用，请各位别怕砖。</p>

<pre class='green'><code>    代码

    Code highlighting produced by Actipro CodeHighlighter (freeware)http://www.CodeHighlighter.com/--&gt; 1 // Learn more about F# at http://fsharp.net

    #light
    open System


    //简单的网页抓取
    open System.Text
    open System.IO
    open System.Net
    let http (url:string)=
        let request=System.Net.WebRequest.Create(url)
        let response=request.GetResponse()
        let stream=response.GetResponseStream()
        let reader=new System.IO.StreamReader(stream)
        let html =reader.ReadToEnd();
        html
    printfn "%s" (http "http://www.google.com")

    //汉罗塔问题：
    let rec HanLiTa n a b c =
        match n with
        | 1 -&gt; printfn " Move %s to %s ;"  a c
        | num -&gt;  HanLiTa (num-1) a c b ;HanLiTa 1 a b c ; HanLiTa (num-1) b a c ;

    let n=4
    printfn "HanLiTa start (%d):" n
    HanLiTa n "A" "B" "C"

    //Fibonacci基数

    let rec Fib n = 
        match n with
        |2 |1 -&gt; 1
        |i when i &gt;1 -&gt; Fib (i-1) + Fib (i-2)
        |x  when x&lt;= 0 -&gt; failwith " you should input a Interger;"

    let fibn=5    
    printfn "Fibonacci %d : %d"     fibn (Fib fibn)


    //杨辉三角
    let rec combi n r =
        let p=ref 1;
        [1 .. r] |&gt; List.iter(fun g -&gt;  p:=!p*(n-g+1)/g );
        !p

    let CombiPrint N=
        [0 .. N] |&gt;
             List.iter(fun g -&gt; ([0 .. g] |&gt;
                                        List.iter(fun h-&gt; 
                                                    if h=0 then 
                                                        [0..(N-g)] |&gt;
                                                                 List.iter(fun s-&gt;printf "  ") ; 
                                                    printf "%5d" (combi g h));
                            printf "\r\n"));

    printfn "\r\n杨辉三角:"
    CombiPrint 10


    Console.Read() |&gt;ignore
</code></pre>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本文通过程序<a href="https://github.com/greengerong/cnblogs-blogs2markdown" title="cnblogs-blogs2markdown">cnblogs-blogs2markdown</a>转换的,如质量有问题<a href="http://www.cnblogs.com/whitewolf/archive/2010/11/29/1891322.html" title="原文首发">原文首发请看这里</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/11/12/VS-shu-chu-chuang-kou-output-view-di-xiao-ji-qiao-wen-jian-hang-hao-zi-fu-ding-wei/">VS输出窗口（output View）的小技巧&#8211;文件行号字符定位</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-12T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2010/11/12/VS-shu-chu-chuang-kou-output-view-di-xiao-ji-qiao-wen-jian-hang-hao-zi-fu-ding-wei/#disqus_thread"
             data-disqus-identifier="http://greengerong.github.io/blog/2010/11/12/VS-shu-chu-chuang-kou-output-view-di-xiao-ji-qiao-wen-jian-hang-hao-zi-fu-ding-wei/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>在我们的调试输出到VS输出窗口的信息，有时候我们想要鼠标点击就定位该该文件，改行，甚至该列。在强大的VS工具中已经给我们提供了这个功能，我们只需要把输出到输出窗</p>

<p>口的字符串就是一定的格式化就可以了。c#在VS输出窗口格式为：
文件名称（行号，列号）:消息信息。
比如我 test.cs（100，78）:消息信息。就是对应我们的test.cs文件的100行78个字符。
在这里我写了一个简单异常输出信息的扩展类。
代码具体如下：&nbsp;&nbsp;&nbsp;</p>

<pre class='green'><code>     代码 

    Code highlighting produced by Actipro CodeHighlighter (freeware)http://www.CodeHighlighter.com/--&gt;public class OutPutExceptionEx
        {
            public static void WriteLine(string message, Exception ex)
            {
                System.Diagnostics.StackTrace st = new System.Diagnostics.StackTrace(ex, true);
                System.Diagnostics.StackFrame frm = st.GetFrame(0);
                if (frm != null)
                {
                    System.Diagnostics.Debug.WriteLine(string.Format("{0}({1},{2}):{3})", frm.GetFileName(), frm.GetFileLineNumber(), frm.GetFileColumnNumber(), 

    message));
                }

            }

            public static void WriteLine(Exception ex)
            {
                WriteLine(ex.Message, ex);
            }

            public static void Write(string message, Exception ex)
            {
                System.Diagnostics.StackTrace st = new System.Diagnostics.StackTrace(ex, true);
                System.Diagnostics.StackFrame frm = st.GetFrame(0);
                if (frm != null)
                {
                    System.Diagnostics.Debug.Write(string.Format("{0}({1},{2}):{3})", frm.GetFileName(), frm.GetFileLineNumber(), frm.GetFileColumnNumber(), 

    message));
                }

            }

            public static void Write(Exception ex)
            {
                Write(ex.Message,ex);
            }
        }

    //测试
        class Program
        {
            static void Main(string[] args)
            {

                try
                {
                    throw new Exception("这个发生了一个错误！");
                }
                catch (Exception ex)
                {
                    OutPutExceptionEx.Write(ex);
                }

                Console.WriteLine("ok");
                Console.Read();           
            }
    }
</code></pre>

<p>图片效果：</p>

<p><img src="http://images.cnblogs.com/cnblogs_com/whitewolf/201011121051.jpg" alt="" /></p>

<p>2：</p>

<p><img src="http://images.cnblogs.com/cnblogs_com/whitewolf/2010111210512.jpg" alt="" /></p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本文通过程序<a href="https://github.com/greengerong/cnblogs-blogs2markdown" title="cnblogs-blogs2markdown">cnblogs-blogs2markdown</a>转换的,如质量有问题<a href="http://www.cnblogs.com/whitewolf/archive/2010/11/12/1875473.html" title="原文首发">原文首发请看这里</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/11/11/MEF-xue-xi-bi-ji/">MEF学习笔记</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-11T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2010/11/11/MEF-xue-xi-bi-ji/#disqus_thread"
             data-disqus-identifier="http://greengerong.github.io/blog/2010/11/11/MEF-xue-xi-bi-ji/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>&nbsp;&nbsp;&nbsp; MEF是 Managed Extensibility Framework简称，在计算机的世界什么都会加一个简称，这我们大家已经司空见惯了。从名字我们可以知道它是一个用于管理的可扩展性框架。这是和EL不同的另一种IOC方式;</p>

<p>&nbsp;&nbsp; MEF 为我们提供了一种运行时的扩展，具体应用在对象的实例化。它有目录（AssemblyCatalog）和容器（CompositionContainer）组成，他有输入输出（Exports和Imports）元数据标记，在对象实例化的时候会自动匹配这个契约。</p>

<p>下面是官方的一个展示图：</p>

<p><a href="http://images.cnblogs.com/cnblogs_com/whitewolf/Windows-Live-Writer/0291ec4c7408_12966/untitled.png"><img src="http://images.cnblogs.com/cnblogs_com/whitewolf/Windows-Live-Writer/0291ec4c7408_12966/untitled_thumb.png" title="untitled" alt="untitled" /></a></p>

<p>由CompositionContainer来管理我们的多个可组合部件。</p>

<p>下面我们来一个简单的示例来初步了解MEF:</p>

<p>控制台程序：</p>

<pre class='green'><code>     代码 

    Code highlighting produced by Actipro CodeHighlighter (freeware)http://www.CodeHighlighter.com/--&gt;using System; 
    using System.Collections.Generic; 
    using System.Linq; 
    using System.Text; 
    using System.ComponentModel.Composition;//添加引用 



    namespace MEFTest 
    { 
        public interface ILog 
        { 
            void Write(string message); 
        } 

        [System.ComponentModel.Composition.Export(typeof(ILog))] 
        public class ConsoleLog:ILog 
        { 
            public void Write(string message) 
            { 
                Console.WriteLine("Hello:"+message); 
            } 
        } 
        class Program 
        { 
            [System.ComponentModel.Composition.Import(typeof(ILog))] 
            public ILog Log; 
            static void Main(string[] args) 
            { 
                Program pro = new Program(); 
                pro.Init(); 
                pro.Log.Write("Test"); 
                Console.Read(); 
            }

            public void Init() 
            { 
                var assem = System.Reflection.Assembly.GetExecutingAssembly();//当前程序集 
                var assemcat = new System.ComponentModel.Composition.Hosting.AssemblyCatalog(assem);//构建目录 
                var container = new System.ComponentModel.Composition.Hosting.CompositionContainer(assemcat);//构建容器 
                container.ComposeParts(this);//这是一个System.ComponentModel.Composition.AttributedModelServices 的扩展方法。 
            } 
        } 
    }
</code></pre>

<p>输出为：</p>

<p>Hello:Test</p>

<p>ExportAttribute 定义如下：</p>

<pre class='green'><code>     代码 

    Code highlighting produced by Actipro CodeHighlighter (freeware)http://www.CodeHighlighter.com/--&gt;[AttributeUsage(AttributeTargets.Class | AttributeTargets.Method | AttributeTargets.Property | AttributeTargets.Field, AllowMultiple = true, Inherited = false)] 
    public class ExportAttribute : Attribute 
    { 

        [TargetedPatchingOptOut("Performance critical to inline this type of method across NGen image boundaries")] 

        [TargetedPatchingOptOut("Performance critical to inline this type of method across NGen image boundaries")] 

        [TargetedPatchingOptOut("Performance critical to inline this type of method across NGen image boundaries")] 
        public ExportAttribute(Type contractType); 

        public ExportAttribute(string contractName, Type contractType);


        public string ContractName { get; } 

        public Type ContractType { get; } 
    }
</code></pre>

<p>从他的定义我们可以知道他可以运用于我们的类、方法、属性、字段，并且可以多继承，但是不存在从父类的继承特性。</p>

<p>他有三种不同的标记方式方式.在MEF中这里标记为可以导出，即注入到Import。</p>

<p>ImportAttribute 定义：</p>

<pre class='green'><code>     代码 

    Code highlighting produced by Actipro CodeHighlighter (freeware)http://www.CodeHighlighter.com/--&gt;[AttributeUsage(AttributeTargets.Property | AttributeTargets.Field | AttributeTargets.Parameter, AllowMultiple = false, Inherited = false)] 
        public class ImportAttribute : Attribute, IAttributedImport 
        { 

            [TargetedPatchingOptOut("Performance critical to inline this type of method across NGen image boundaries")] 
            public ImportAttribute(); 

            [TargetedPatchingOptOut("Performance critical to inline this type of method across NGen image boundaries")] 
            public ImportAttribute(string contractName); 

            [TargetedPatchingOptOut("Performance critical to inline this type of method across NGen image boundaries")] 
            public ImportAttribute(Type contractType); 

            public ImportAttribute(string contractName, Type contractType); 

            public bool AllowDefault { get; set; }

            public bool AllowRecomposition { get; set; } 

            public string ContractName { get; } 

            public Type ContractType { get; } 

            public CreationPolicy RequiredCreationPolicy { get; set; } 
        }
</code></pre>

<p>&nbsp;同上Export,这里标记为可被Export注入的接口点。</p>

<p>今天就写到这里了，希望大家多多指教，大家一起共同进步。</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本文通过程序<a href="https://github.com/greengerong/cnblogs-blogs2markdown" title="cnblogs-blogs2markdown">cnblogs-blogs2markdown</a>转换的,如质量有问题<a href="http://www.cnblogs.com/whitewolf/archive/2010/11/11/MEF1.html" title="原文首发">原文首发请看这里</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/11/10/fan-yi-31-tian-Windows-Phone-xue-xi-1-xiang-mu-mo-ban/">(翻译)31天Windows Phone学习-1-项目模板</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-10T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2010/11/10/fan-yi-31-tian-Windows-Phone-xue-xi-1-xiang-mu-mo-ban/#disqus_thread"
             data-disqus-identifier="http://greengerong.github.io/blog/2010/11/10/fan-yi-31-tian-Windows-Phone-xue-xi-1-xiang-mu-mo-ban/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>&nbsp;&nbsp;&nbsp; 今天在在外文网站Google关于Windows Phone 7的学习资料，无疑间Google到了<a href="http://www.jeffblankenburg.com/author/jeffblankenburg.aspx">Jeff Blankenburg</a>的 <a href="http://www.jeffblankenburg.com/post/31-Days-of-Windows-Phone-7c-Day-1-Project-Template.aspx">31 Days of Windows Phone</a> 这个系列，感觉写的比较基础和浅显易懂，适合我这种入们级的人学习，所以准备拿来对Windows Phone 7的简单入门学习。并翻译出来供像我一样的菜鸟学习，我的E文并不好，所以翻译难免会有一些不对的忘大家原谅和多多指教。说道E文又想起大学时，就是因为这个E文让我少的了一大笔奖学金，哎。翻译这个系列，也顺便提高一下我的E文吧，呵呵。</p>

<p>&nbsp;&nbsp; 步入正题：今天是我们Windows Phone学习的第一天，是一些关于项目模板的。</p>

<p>&nbsp; 首先： 在学习Windows Phone7之前我们假设你已经对Microsoft 的Silverlight有了一定的了解，如果你还不了解，你也可以参考作者的&nbsp; 20天Silverlight这个系列&nbsp; ，讲解的都是一些Silverlight的基础级知识。</p>

<p>&nbsp; 再者我们假设你已经安装了Microsoft 所有Windows Phone Tools，如果你没有安装，你可以从这里下载<a href="http://developer.windowsphone.com/">http://developer.windowsphone.com/</a>，从这里我们会获得Visual Studio 2010 for Windows Phone和 Expression Blend 4 for&nbsp; Windows Phone。如果在你的机子已经安装了官方的正式版，你仅需要更新添加一些新的模板。</p>

<p>&nbsp;&nbsp; 在今天我们会预览一下Visual Studio 2010为我们的Windows Phone应用程序生成的默认模板。</p>

<p><img src="http://www.jeffblankenburg.com/image.axd?picture=NewProject.png" title="NewProject" alt="NewProject" /></p>

<h4><font style="font-weight: bold">Solution Explorer：</font></h4>

<p>下面是vs2010默认为我们生成的解决方案，我不准备详细介绍各个文件，你可以从<a target="_blank"><a href="http://bit.ly/8XcWaO"><font color="#3d81ee">安装上所有Tools</font></a>&nbsp;</a>并自己尝试，比较简单。</p>

<h4><img src="http://www.jeffblankenburg.com/image.axd?picture=SolutionExplorer.png" title="SolutionExplorer" alt="SolutionExplorer" /></h4>

<h4><font style="font-weight: bold">ApplicationIcon.png:</font></h4>

<p>&nbsp; 是Phone application List现实的图标，你也可以替换成你想要的图标。</p>

<h4><font style="font-weight: bold">App.xaml：</font></h4>

<h4>&nbsp; 有点像ASP.NET web.config 文件，保存了我们应用程序的常用数据和设置，我更喜欢防止我的style在这里，但这不是必须的。</h4>

<h4><font style="font-weight: bold">App.xaml.cs：</font></h4>

<p>是前一文件（App.xaml）的Code-Behind文件，和前一个文件一起定义我们应用程序的入口点，初始化应用程序级别的全局静态资源(StaticResource)和启动程序的页面。</p>

<h4><font style="font-weight: bold">AssemblyInfo.cs：</font></h4>

<p>定义了我们应用程序的程序集信息，入 版本，名称等。个人觉得和我们的WinForm、Asp.net程序应该差不多。</p>

<h4><font style="font-weight: bold">Background.png：</font></h4>

<p>是我们应用程启动时的屏幕背景，我们也可以替换为你需要的图标。</p>

<h4><font style="font-weight: bold">MainPage.xaml：</font></h4>

<p>是我们应用程序启动的默认页面，这只是一个一般习惯，我们也可以在WMAppManifest.xml 中修改：</p>

<pre class='green'>&lt;Tasks&gt;</pre>


<pre class='green'>       &lt;DefaultTask  Name ="_default" NavigationPage="MainPage.xaml"/&gt;    </pre>


<pre class='green'> &lt;/Tasks&gt;</pre>


<h4><font style="font-weight: bold">MainPage.xaml.cs：</font></h4>

<p>前一个文件(MainPage.xaml)的Code-Behind文件，在这里需要我们编辑页面启动页面的Code.</p>

<h4><font style="font-weight: bold">SplashScreenImage.jpg:</font></h4>

<p>应用程序加载图标（即：我的应用程序启动，第一个页面还没有显示时）。我们也可以替换这个图标。在这里只是为了让我们的用户了解程序正在加载。</p>

<h4><font style="font-weight: bold">WMAppManifest.xml：</font></h4>

<p>用于定义我们应用程序打包的文件(manifest)。 Silverlight程序最终会打成xap包（zip格式），里面包含了程序需要用到的所有资源（例如图片，声音文件等等），和依赖 的第三方DLL等等。AppManifest.xml文件用于定义打包的结构。</p>

<p>&nbsp;</p>

<p>第一天学习很简单，就到这里的作者给我们提供了Code下载，其实我觉得没有必要。所以偷个懒了。</p>

<p>本文E文原文：<a href="http://www.jeffblankenburg.com/post/31-Days-of-Windows-Phone-7c-Day-1-Project-Template.aspx" title="http://www.jeffblankenburg.com/post/31-Days-of-Windows-Phone-7c-Day-1-Project-Template.aspx">http://www.jeffblankenburg.com/post/31-Days-of-Windows-Phone-7c-Day-1-Project-Template.aspx</a></p>

<p>关于Windows Phone的一些学习资料：</p>

<p>1：首先是翻译的原文：&nbsp;<a href="http://www.jeffblankenburg.com/author/jeffblankenburg.aspx">Jeff Blankenburg</a>博客<a href="http://www.jeffblankenburg.com/post/31-Days-of-Windows-Phone-7c-Day-1-Project-Template.aspx" title="http://www.jeffblankenburg.com/post/31-Days-of-Windows-Phone-7c-Day-1-Project-Template.aspx">http://www.jeffblankenburg.com/post/31-Days-of-Windows-Phone-7c-Day-1-Project-Template.aspx</a></p>

<p>2: 园友<a href="#">306Room</a>的一起学Windows Phone系列<a href="http://www.cnblogs.com/randylee/category/258713.html" title="http://www.cnblogs.com/randylee/category/258713.html">http://www.cnblogs.com/randylee/category/258713.html</a></p>

<p>3：<a href="http://windowsteamblog.com/windows_phone/" title="http://windowsteamblog.com/windows_phone/">http://windowsteamblog.com/windows_phone/</a></p>

<p>4：<a href="http://create.msdn.com/en-US/" title="http://create.msdn.com/en-US/">http://create.msdn.com/en-US/</a></p>

<p>还有其他的我在后续看见了，也会一一不上。也希望大家给我提供一些学习资料，共同进步。</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本文通过程序<a href="https://github.com/greengerong/cnblogs-blogs2markdown" title="cnblogs-blogs2markdown">cnblogs-blogs2markdown</a>转换的,如质量有问题<a href="http://www.cnblogs.com/whitewolf/archive/2010/11/10/1873273.html" title="原文首发">原文首发请看这里</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/09/27/Dbml-wen-jian-ti-qu-jian-biao-TSql-CodeSmith/">Dbml文件提取建表TSql-CodeSmith</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-27T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2010/09/27/Dbml-wen-jian-ti-qu-jian-biao-TSql-CodeSmith/#disqus_thread"
             data-disqus-identifier="http://greengerong.github.io/blog/2010/09/27/Dbml-wen-jian-ti-qu-jian-biao-TSql-CodeSmith/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>&nbsp;&nbsp;&nbsp;&nbsp; 在昨天一个大学师弟，他问我能不能将LinqToSql文件转化为创建表的TSql语句，他是刚开始学习.NET，所以在网上下些示例看，但苦于没有数据库。所以就有了这一篇博客，作为我的Code生成技术的CodeSimth的最后一篇示例。在下一步Code 生成技术将转到Microsoft的T4模板，Code生成技术目前完成的有<a href="http://www.cnblogs.com/whitewolf/archive/2010/07/09/1774279.html">CodeDom</a>,<a href="http://www.cnblogs.com/whitewolf/archive/2010/09/27/1836729.html">CodeSmith模板</a>，高手请不要拍砖，请直接跳过。</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp; 在Linq2Sql的Dbml文件其实就是一个Xml文件，记录着数据库与生成Linq2SqlCode的数据信息，所以转化为TSql没有什么说的。我们需要提取其中的数据库信息，在转化为我们的Tsql，在这里建立了DBTable、DBColumn、DBAssociation三个实体类：</p>

<pre class='green'><code>    代码 

    Code highlighting produced by Actipro CodeHighlighter (freeware)http://www.CodeHighlighter.com/--&gt;  1 using System; 
    using System.Collections.Generic; 
    using System.Linq; 
    using System.Text; 

    namespace DbmlToTable 
    { 
        public class DBTable 
        { 

            public DBTable() 
            { 
                Columns = new List&lt;DBColumn&gt;(); 
                this.Associations = new List&lt;DBAssociation&gt;(); 
            } 

            public string TableName 
            { 
                get; 
                set; 
            } 

            public List&lt;DBColumn&gt; Columns 
            { 
                get; 
                set; 
            } 

            public List&lt;DBAssociation&gt; Associations 
            { 
                get; 
                set; 
            } 

        } 

        public class DBColumn 
        { 
            public string Name 
            { 
                get; 
                set; 
            } 

            public string DBType 
            { 
                get; 
                set; 
            } 

            public bool IsPrimaryKey 
            { 
                get; 
                set; 
            } 

            public bool IsDbGenerated 
            { 
                get; 
                set; 
            } 

            public bool CanBeNull 
            { 
                get; 
                set; 
            } 
        } 

        public class DBAssociation 
        { 
            public string Name 
            { 
                get; 
                set; 
            } 

            public string ThisKey 
            { 
                get; 
                set; 
            } 

            public string OtherKey 
            { 
                get; 
                set; 
            } 

            public bool IsForeignKey 
            { 
                get; 
                set; 
            } 
        } 

        public class DBTableHlper 
        { 
            public static DBTable GetAssociationTable(List&lt;DBTable&gt; collection,string assName) 
            { 

                return collection.Find(t =&gt; t.Associations.Find(a =&gt; !a.IsForeignKey &amp;&amp; a.Name == assName) != null); 
            } 
        } 
    }
</code></pre>

<p>&nbsp;&nbsp;&nbsp; 其中DBTableHlper是由于我的Codesimth是2.0版本的，不能用lamdam表达式，所以我将它编译在程序集里面。</p>

<p>&nbsp;&nbsp; 建立了一个 将我们的dbml文件xml Document转化为实体类辅助类：</p>

<pre class='green'><code>     代码 

    Code highlighting produced by Actipro CodeHighlighter (freeware)http://www.CodeHighlighter.com/--&gt; 1 using System; 
    using System.Collections.Generic; 
    using System.Linq; 
    using System.Text; 
    using System.Xml; 
    using System.Xml.Linq; 

    namespace DbmlToTable 
    { 

        public interface IDbTableCollectionHelper 
        { 
            List&lt;DBTable&gt; Transport(XElement element); 
        } 

        public class DbTableCollectionHelper : IDbTableCollectionHelper 
        { 
            #region IDbTableCollectionHelper 成员 

            public List&lt;DBTable&gt; Transport(XElement element) 
            { 
                List&lt;DBTable&gt; collection = new List&lt;DBTable&gt;(); 
                var tables = element.Elements(XName.Get("Table", "http://schemas.microsoft.com/linqtosql/dbml/2007%22)); 
                foreach (var tab in tables) 
                { 
                    DBTable t = new DBTable() { TableName = tab.Attribute("Name").Value }; 
                    var cols = tab.Element(XName.Get("Type", "http://schemas.microsoft.com/linqtosql/dbml/2007%22)).Elements(XName.Get(%22Column%22, "http://schemas.microsoft.com/linqtosql/dbml/2007%22)); 
                    foreach (var col in cols) 
                    { 
                        DBColumn c = new DBColumn() 
                        { 
                            CanBeNull = col.Attribute("CanBeNull") != null ? col.Attribute("CanBeNull").Value.ToLower() == "true" : false, 
                            DBType = col.Attribute("DbType") != null ? col.Attribute("DbType").Value : "", 
                            IsDbGenerated = col.Attribute("IsDbGenerated") != null ? col.Attribute("IsDbGenerated").Value.ToLower() == "true" : false, 
                            IsPrimaryKey = col.Attribute("IsPrimaryKey") != null ? col.Attribute("IsPrimaryKey").Value.ToLower() == "true" : false, 
                            Name = col.Attribute("Name") != null ? col.Attribute("Name").Value : "" 
                        }; 
                        t.Columns.Add(c); 
                    } 

                    var ass = tab.Element(XName.Get("Type", "http://schemas.microsoft.com/linqtosql/dbml/2007%22)).Elements(XName.Get(%22Association%22, "http://schemas.microsoft.com/linqtosql/dbml/2007%22)); 
                    foreach (var item in ass) 
                    { 
                        DBAssociation a = new DBAssociation() 
                        { 
                            Name = item.Attribute("Name") != null ? item.Attribute("Name").Value : "", 
                            OtherKey = item.Attribute("OtherKey") != null ? item.Attribute("OtherKey").Value : "", 
                            ThisKey = item.Attribute("ThisKey") != null ? item.Attribute("ThisKey").Value : "", 
                            IsForeignKey = item.Attribute("IsForeignKey") != null ? item.Attribute("IsForeignKey").Value.ToLower() == "true" : false 
                        }; 
                        t.Associations.Add(a); 
                    } 
                    collection.Add(t); 
                } 
                return collection; 
            } 

            #endregion 
        } 
    }
</code></pre>

<p>&nbsp;&nbsp; 在转化为我们的实体类，我们剩下的就是编写我们的CodeSmith模板了（更多知识可以参考<a href="http://www.cnblogs.com/whitewolf/archive/2010/09/27/1836729.html">CodeSmith模板</a>）：</p>

<pre class='green'><code>     代码 

    Code highlighting produced by Actipro CodeHighlighter (freeware)http://www.CodeHighlighter.com/--&gt; 1 &lt;%@ CodeTemplate Language="C#" TargetLanguage="Text" Src="" Inherits="" Debug="False" Description="Template description here." %&gt; 

    &lt;%@ Import NameSpace="System" %&gt; 
    &lt;%@ Import NameSpace="System.Xml" %&gt; 
    &lt;%@ Import NameSpace="System.Text" %&gt; 
    &lt;%@ Import NameSpace="System.Collections.Generic" %&gt; 
    &lt;%@ Assembly Name="DbmlToTable" %&gt; 

    --Code By Wolf 
    &lt;script runat="template"&gt; 
    private List&lt;DbmlToTable.DBTable&gt; _DbTableCollection; 
    public List&lt;DbmlToTable.DBTable&gt; DbTableCollection 
    { 
        get 
        { 
            return _DbTableCollection; 
        } 
        set    
        { 
            _DbTableCollection=value; 
        } 
    } 

    public  string GeneratorTableSql(List&lt;DbmlToTable.DBTable&gt; collection) 
    { 
        StringBuilder sb = new StringBuilder(); 
        StringBuilder sbAssocation = new StringBuilder(); 
        foreach (DbmlToTable.DBTable item in collection) 
        { 
            List&lt;string&gt; cols = new List&lt;string&gt;(); 
            foreach (DbmlToTable.DBColumn  col in item.Columns) 
            { 
                cols.Add(string.Format("{0} {1} {2} ", col.Name, col.DBType, col.IsPrimaryKey ? "PRIMARY KEY " : "")); 
            } 
            sb.AppendFormat("\r\nCREATE TABLE {0} \r\n(\r\n{1}\r\n)", item.TableName, string.Join(",\r\n", cols.ToArray())); 

            foreach (DbmlToTable.DBAssociation ass in item.Associations) 
            { 
                if (ass.IsForeignKey) 
                { 
                    DbmlToTable.DBTable tab = DbmlToTable.DBTableHlper.GetAssociationTable(collection,ass.Name); 
                    if (tab != null) 
                    { 
                        sbAssocation.AppendLine(); 
                        sbAssocation.AppendFormat(@"ALTER TABLE {0}  WITH NOCHECK ADD  CONSTRAINT {1} FOREIGN KEY({2}) REFERENCES {3} ({4})", 
                            item.TableName, "FK_" + ass.Name, ass.ThisKey, tab.TableName, ass.OtherKey); 
                    } 
                } 
            } 
        } 

        return sb.ToString() + "\r\n" + sbAssocation.ToString(); 
    } 
    &lt;/script&gt; 
    &lt;%= this.GeneratorTableSql(_DbTableCollection) %&gt;
</code></pre>

<p>&nbsp;&nbsp;&nbsp; 在codeSimth中我们建立了一个集合属性传递实体类DBTable和一个转化TSql辅助方法.</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 在控制台调用编译模板以及输出：</p>

<pre class='green'><code>    代码 

    Code highlighting produced by Actipro CodeHighlighter (freeware)http://www.CodeHighlighter.com/--&gt; 1 using System; 
    using System.Collections.Generic; 
    using System.Linq; 
    using System.Text; 

    namespace DbmlToTable 
    { 
        class Program 
        { 
            static void Main(string[] args) 
            { 
                IDbTableCollectionHelper helper = new DbTableCollectionHelper(); 
                List&lt;DBTable&gt; collection = helper. 
                    Transport(System.Xml.Linq.XElement.

             Load(@"xxpath\MultipleDocument.Data\MultipleDocumentDB.dbml")); 

                CodeSmith.Engine.CodeTemplate template = CodeSimthTemplateHelper. 
                    CompileTemplate(@"DBMLToTable.cst", w =&gt; Console.WriteLine(w)); 
                if (template != null) 
                { 
                    CodeSimthTemplateHelper.AddPropertyParams(template, new { DbTableCollection = collection }); 
                    string str = template.RenderToString(); 
                    Console.WriteLine(str); 
                    //System.IO.File.AppendAllText(@"D:\1.sql", str); 
                } 
                Console.Read(); 
            }

    }
</code></pre>

<p>&nbsp;&nbsp; 在CodeSimth中就是这么简单，生成相应的模板代码（个人理解CodeSmith就是把代码作为字符串输出）。</p>

<p>在上面到我的CodeSmith模板编译辅助类，在上一篇<a href="http://www.cnblogs.com/whitewolf/archive/2010/09/25/1834317.html">通过代码生成机制实现强类型编程-CodeSmith版</a>也有，在这里也附带上：需要引用CodeSmith.Engine.dll.</p>

<pre class='green'><code>    代码 

        Code highlighting produced by Actipro CodeHighlighter (freeware)http://www.CodeHighlighter.com/--&gt; 1 using System; 

        using System.Collections.Generic; 

        using System.Linq; 

        using System.Text; 

        using CodeSmith.Engine; 

        using Wolf.NameValueDictionary; 

        namespace DbmlToTable 

        { 

        public class CodeSimthTemplateHelper 

        { 

             public static CodeTemplate CompileTemplate(string templateName, Action errorWriter) 

             { 

                   CodeTemplateCompiler compiler = new CodeTemplateCompiler(templateName); compiler.Compile(); 

                  if (compiler.Errors.Count == 0) 

                   { 

                   return compiler.CreateInstance();

                   } 

               else 

                 { 

                   for (int i = 0; i &lt; compiler.Errors.Count; i++) 

                { 

                    errorWriter(compiler.Errors[i].ToString()); 

                 } 

                return null; 

               } 

        } 



        public static void AddPropertyParams(CodeTemplate template,object param) 

        { 

              NameValueDictionary dict = new NameValueDictionary&lt;object&gt;(param);

               AddPropertyParams(template, dict);

        }



        public static void AddPropertyParams(CodeTemplate template, NameValueDictionary&lt;object&gt; param)

        {

                  NameValueDictionary&lt;object&gt; dict = new NameValueDictionary&lt;object&gt;(param);

                  foreach (var item in dict.Keys)

                  {

                        template.SetProperty(item, dict[item]);

                   }

        }

        }

        }
</code></pre>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本文通过程序<a href="https://github.com/greengerong/cnblogs-blogs2markdown" title="cnblogs-blogs2markdown">cnblogs-blogs2markdown</a>转换的,如质量有问题<a href="http://www.cnblogs.com/whitewolf/archive/2010/09/27/1836731.html" title="原文首发">原文首发请看这里</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/09/27/CodeSmith-mo-ban-yin-qing-xi-lie-mu-lu/">CodeSmith模板引擎系列-目录</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-27T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2010/09/27/CodeSmith-mo-ban-yin-qing-xi-lie-mu-lu/#disqus_thread"
             data-disqus-identifier="http://greengerong.github.io/blog/2010/09/27/CodeSmith-mo-ban-yin-qing-xi-lie-mu-lu/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CodeSmith是一个基于模板的代码生成器，它可以生成任何基于ASCII的编程语言代码。生成的代码可以使用属性进行定制。属性可以是任何具有设计器的.NET对象（大多数.NET内置类型已经有设计器），也可以是一个允许你从结果中有条件地添加或移除代码的简单的boolean 属性，或是一个对象，例如能够访问数据库表信息的TableSchema对象（包括在SchemaExplorer中）。CodeSmith完全可扩展，它允许用户创建定制属性类型。CodeSmith中包括多个定制属性类型的例子，例如，定制一个允许选择XML文件（使用XmlSerializer可将其反序列化到对象中）的属性类型。CodeSmith还允许用户在模板中引用和调用指定的外部程序集并且允许从外部程序集的类生成模板。</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CodeSmith的语法与ASP.NET几乎相同。因此如果你熟悉ASP.NET ，那么应该会很快理解模板语法。你可以在模板中使用C#、VB.NET或JScript.NET语言，并且模板可以输出任何基于ASCII的语言。CodeSmith还包括一个名为SchemaExplorer的程序集，利用它可以访问几乎所有的数据库概要（schema）细节。访问这种信息让你能够生成各种代码，例如存储过程、类型DataSet、业务对象、表示层代码或任何其它基于数据库概要信息的代码。（来自:<a href="http://msdn.microsoft.com/msdnmag/issues/04/07/MustHaveTools/default.aspx">http://msdn.microsoft.com/msdnmag/issues/04/07/MustHaveTools/default.aspx</a>）</p>

<ol>
<li><a href="http://www.cnblogs.com/whitewolf/archive/2010/07/13/1776379.html">CodeSmith模板引擎系列一</a></li>
<li><a href="http://www.cnblogs.com/whitewolf/archive/2010/07/14/1777088.html">CodeSmith模板引擎系列二&mdash;文件目录树</a></li>
<li><a href="http://www.cnblogs.com/whitewolf/archive/2010/09/25/CodeSimthNamedCMessage.html">通过代码生成机制实现强类型编程-CodeSimth版</a></li>
<li><a href="http://www.cnblogs.com/whitewolf/archive/2010/09/27/1836731.html"><font color="#6699cc">Dbml文件提取建表TSql-CodeSmith</font></a></li>
</ol>


<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 打算写一些代码生成编译技术的系列，包括<a href="http://www.cnblogs.com/whitewolf/archive/2010/07/09/1774279.html">CodeDom（CodeDom的代码生成技术目录</a>），<a href="#">CodeSmith模板</a>、T4模板、StringTemplate,以及Expression Tree的系列随笔。如果可能的话再加上Emit系列。欢迎大家多多指教和交流。</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本文通过程序<a href="https://github.com/greengerong/cnblogs-blogs2markdown" title="cnblogs-blogs2markdown">cnblogs-blogs2markdown</a>转换的,如质量有问题<a href="http://www.cnblogs.com/whitewolf/archive/2010/09/27/1836729.html" title="原文首发">原文首发请看这里</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/09/25/tong-guo-dai-ma-sheng-cheng-ji-zhi-shi-xian-qiang-lei-xing-bian-cheng-CodeSimth-ban/">通过代码生成机制实现强类型编程-CodeSimth版</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-25T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2010/09/25/tong-guo-dai-ma-sheng-cheng-ji-zhi-shi-xian-qiang-lei-xing-bian-cheng-CodeSimth-ban/#disqus_thread"
             data-disqus-identifier="http://greengerong.github.io/blog/2010/09/25/tong-guo-dai-ma-sheng-cheng-ji-zhi-shi-xian-qiang-lei-xing-bian-cheng-CodeSimth-ban/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 一直想写一个Code生成系列，但写到CodeSimth，发觉在<a href="http://terrylee.cnblogs.com/archive/2005/12/28/306254.aspx">TerryLee</a> 和<a href="http://www.cnblogs.com/Bear-Study-Hard/category/43725.html">努力学习的小熊</a> 两位大牛的博客里讲很详尽，所以就像写些示例方面的，但是苦于没有想到写些什么。最近<a href="http://www.cnblogs.com/artech/">Artech</a>写了两篇<a href="http://www.cnblogs.com/artech/archive/2010/09/16/1827499.html">从数据到代码&#8212;&#8212;通过代码生成机制实现强类型编程&mdash;上篇和下篇</a>，大牛写得是CodeDom的，今天我就想借借大牛的示例写个CodeSimth版的，希望<a href="http://www.cnblogs.com/artech/">Artech</a>不要怪我，呵呵。我的Code生成技术已经写了CodeDom的见<a href="http://www.cnblogs.com/whitewolf/archive/2010/07/09/1774279.html">CodeDom系列目录</a>，欢迎各位园友指教。</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 好直接到主题。首先是数据实体MessageEntry（我到老A的基础上添加了description属性作为代码字段描述）：</p>

<pre class='green'><code>       public class MessageEntry 
        { 
            public string Id { get; private set; } 
            public string Value { get; private set; }        
            public string Description { get; private set; } 
            public MessageEntry(string id, string value) 
            { 
                this.Id = id; 
                this.Value = value;         
            } 

            public MessageEntry(string id, string value, string description) 
            { 
                this.Id = id; 
                this.Value = value; 
                this.Description = description; 
            } 

            public string Format(params object[] args) 
            { 
                return string.Format(this.Value, args); 
            } 
        } 
</code></pre>

<p>在我的机子上的CodeSimth是2..0版本的所以不能使用Linq命名空间，我又想利用这个空间，比较快捷，所以我就在先3.0转化为</p>

<p>Dictionary&lt;string, List&lt;MessageEntry&gt;&gt;实体再传入模板：</p>

<p>Code：</p>

<pre class='green'><code>     using System.Collections.Generic; 
    using System.Linq; 
    using System.Text; 
    using System.Xml; 
    using System.Xml.Linq; 

    namespace Wolf 
    { 
        public class MessageCodeGenerator 
        { 
            public Dictionary&lt;string, List&lt;MessageEntry&gt;&gt; GeneratorCode(string  path) 
            { 
                return GeneratorCode(XElement.Load(path)); 
            } 
            public Dictionary&lt;string, List&lt;MessageEntry&gt;&gt; GeneratorCode(XElement root) 
            { 

                var elemts = root.Elements("message").GroupBy(e =&gt; ((XAttribute)e.Attribute("category")).Value); 
                Dictionary&lt;string, List&lt;MessageEntry&gt;&gt;  dict = new Dictionary&lt;string, List&lt;MessageEntry&gt;&gt;(); 
                foreach (var item in elemts) 
                { 
                    List&lt;MessageEntry&gt; list = new List&lt;MessageEntry&gt;(); 
                    foreach (var g in item) 
                    { 
                        if (g.Attribute("description") != null) 
                        { 
                            list.Add(new MessageEntry(((XAttribute)g.Attribute("id")).Value, ((XAttribute)g.Attribute("value")).Value, ((XAttribute)g.Attribute("description")).Value)); 
                        } 
                        else 
                        { 
                            list.Add(new MessageEntry(((XAttribute)g.Attribute("id")).Value, ((XAttribute)g.Attribute("value")).Value)); 
                        } 

                    } 
                    dict.Add(item.Key.ToString(), list); 
                } 
                return dict; 

            } 
        } 
    }
</code></pre>

<p> 这下就可以开始写模板了，见下Code：</p>

<pre class='green'><code>      &lt;%@ CodeTemplate Language="C#" TargetLanguage="Text" Src="" Inherits="" Debug="False" Description="Template description here." %&gt; 

    &lt;%@ Import NameSpace="System" %&gt; 
    &lt;%@ Import NameSpace="System.Xml" %&gt; 
    &lt;%@ Import NameSpace="System.Text" %&gt; 
    &lt;%@ Import NameSpace="System.Collections.Generic" %&gt; 
    &lt;%@ Import NameSpace="Wolf" %&gt; 
    &lt;%@ Assembly Name="Wolf" %&gt; 

    &lt;script runat="template"&gt; 

    private Dictionary&lt;string, List&lt;MessageEntry&gt;&gt; dict; 
    public Dictionary&lt;string, List&lt;MessageEntry&gt;&gt; Generator 
    { 
        get 
        { 
            return dict; 
        } 
        set 
        { 
            dict=value; 
        } 
    } 

    public string GeneratorCode() 
            {            
                string str = "using Wolf;\r\nusing System;\r\nusing System.Collections.Generic;\r\nnamespace Wolf.Message\r\n{ \r\n   public class Messages\r\n    {\r\n"; 
                foreach (string catage in Generator.Keys) 
                { 
                    str += "        public class  "+catage + "\r\n        {        \r\n"; 
                    foreach (Wolf.MessageEntry entry in Generator[catage]) 
                    { 
                        str += "\r\n            /// &lt;summary&gt;" + 
                        "\r\n            ///" + entry.Description + 
                        "\r\n            /// &lt;/summary&gt;" + 
                        "\r\n            public static Wolf.MessageEntry " + entry.Id + " = new MessageEntry(\"" + entry.Id + "\", \"" + entry.Value +"\", \"" + entry.Value +"\");\r\n"; 
                    } 
                    str += "\r\n        }\r\n\r\n"; 

                } 
                str += "\r\n    }\r\n}"; 
                return str; 
            } 

    &lt;/script&gt; 
    //Copyright (C) Wolf.  All rights reserved. 
    &lt;%=  GeneratorCode()%&gt;
</code></pre>

<p>很简单，就不说了，如果有问题请留言，其中命名空间完全可以以属性方式传入。</p>

<p>XMl实体用的是老A的：</p>

<pre class='green'><code> &lt;?xml version="1.0" encoding="utf-8" ?&gt;  
    &lt;messages&gt;   
    &lt;message id="MandatoryField" value="The {0} is mandatory."  category="Validation"  description="description" /&gt;   
    &lt;message id="GreaterThan" value="The {0} must be greater than {1}."  category="Validation" description="description" /&gt;   
    &lt;message id="ReallyDelete" value="Do you really want to delete the {0}."  category="Confirmation" description="description" /&gt;  
&lt;/messages&gt;
</code></pre>

<p>我想脱离CodeSimth工具，所以在建立了一个控制台程序，引用CodeSmith.Engine.dll程序集。</p>

<p>Code：</p>

<pre class='green'><code> public static void Main(string[] args) 
       { 
          //    Wolf.Message.Messages.Confirmation.ReallyDelete.Value 
           // test(); 
           CodeTemplate template = CompileTemplate(@"E:\MyApp\LinqTest\ConsoleApplication1\MessageCodeGenerator.cst",s=&gt;Console.WriteLine(s)); 
           if (template != null) 
           { 
               template.SetProperty("_MessageFilePath", ""); 
               Wolf.MessageCodeGenerator gen = new MessageCodeGenerator(); 
      Dictionary&lt;string, List&lt;MessageEntry&gt;&gt; dict = gen.GeneratorCode(@"E:\MyApp\LinqTest\ConsoleApplication1\Sample.xml"); 
               template.SetProperty("Generator", dict); 
               template.RenderToFile("gen.cs", true); 
              // System.Diagnostics.Process.Start("gen.cs"); 
           } 
          // Console.Read(); 

       }

       public static CodeTemplate CompileTemplate(string templateName,Action&lt;string&gt; errorWriter) 
       { 
           CodeTemplateCompiler compiler = new CodeTemplateCompiler(templateName); 
           compiler.Compile(); 

           if (compiler.Errors.Count == 0) 
           { 
               return compiler.CreateInstance(); 
           } 
           else 
           { 
               for (int i = 0; i &lt; compiler.Errors.Count; i++) 
               { 
                   errorWriter(compiler.Errors[i].ToString()); 
               } 
               return null; 
           } 

       }
</code></pre>

<p>生成后的代码：</p>

<p>&nbsp;</p>

<pre class='green'><code> using Wolf; 
using System; 
using System.Collections.Generic; 
namespace Wolf.Message 
{ 
    public class Messages 
    { 
        public class Validation 
        { 

            /// &lt;summary&gt; 
            ///description 
            /// &lt;/summary&gt; 
            public static Wolf.MessageEntry MandatoryField = new MessageEntry("MandatoryField", 

"The {0} is mandatory.", "The {0} is mandatory."); 

            /// &lt;summary&gt; 
            ///description 
            /// &lt;/summary&gt; 
            public static Wolf.MessageEntry GreaterThan = new MessageEntry("GreaterThan", 

"The {0} must be greater than {1}.", "The {0} must be greater than {1}."); 

        } 

        public class Confirmation 
        { 

            /// &lt;summary&gt; 
            ///description 
            /// &lt;/summary&gt; 
            public static Wolf.MessageEntry ReallyDelete = new MessageEntry("ReallyDelete", 

"Do you really want to delete the {0}.", "Do you really want to delete the {0}."); 

        } 

    } 
}
</code></pre>

<p>ok，全部完成。同时你也可以完全集成与VS中利用VSX Vs扩展，可以参考<a href="http://www.cnblogs.com/default/archive/2010/02/26/1674582.html">明年我18 的VSX系列</a></p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本文通过程序<a href="https://github.com/greengerong/cnblogs-blogs2markdown" title="cnblogs-blogs2markdown">cnblogs-blogs2markdown</a>转换的,如质量有问题<a href="http://www.cnblogs.com/whitewolf/archive/2010/09/25/CodeSimthNamedCMessage.html" title="原文首发">原文首发请看这里</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/09/15/Linq-duo-biao-cha-xun-tiao-jian-pi-liang-shan-chu/">Linq多表查询条件批量删除</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-15T00:00:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2010/09/15/Linq-duo-biao-cha-xun-tiao-jian-pi-liang-shan-chu/#disqus_thread"
             data-disqus-identifier="http://greengerong.github.io/blog/2010/09/15/Linq-duo-biao-cha-xun-tiao-jian-pi-liang-shan-chu/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 前阵写了Linq的单表生成相对Sql执行的批量删除，总觉得删除条件太局限了，并且又不能屏蔽linq的级联条件，这很容易误导一些人。所以想了应该还是要支持才好。呵呵。</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp; 其实思路和上次一样，就是生成Sql，用Linq自身条件组合sql应用，没有什么好说的。组合sql用 EXISTS关键字，组合一个子查询。</p>

<pre class='green'><code> DELETE FROM [TableName]   WHERE   EXISTS(select ..from         [TableName]  where query );
</code></pre>

<p>&nbsp;</p>

<p>直接上Code：</p>

<pre class='green'><code>/// EXISTS
/// &amp;lt;/summary&amp;gt;
/// &amp;lt;typeparam name="T"&amp;gt;&amp;lt;/typeparam&amp;gt;
/// &amp;lt;param name="source"&amp;gt;&amp;lt;/param&amp;gt;
/// &amp;lt;param name="query"&amp;gt;&amp;lt;/param&amp;gt;
/// &amp;lt;returns&amp;gt;&amp;lt;/returns&amp;gt;
public static int Delete&amp;lt;T&amp;gt;(this System.Data.Linq.Table&amp;lt;T&amp;gt; source, Expression&amp;lt;Func&amp;lt;T, bool&amp;gt;&amp;gt; query)
where T : class
{
if (source == null)
throw new ArgumentException("source");
if (query == null)
throw new ArgumentException("query");
//query = t =&amp;gt; true;
//为空DELETE  FROM [dbo].[test] 全删除；个人觉得为空全删除，很不人道，所以还是抛异常
System.Data.Linq.DataContext db = source.Context;
DbCommand cmd= db.GetCommand(source.Where(query));
string queryStr = cmd.CommandText;
string sql = "DELETE FROM " + source.Context.Mapping.GetTable(typeof(T)).TableName + " WHERE   EXISTS(" + queryStr+")";
List&amp;lt;object&amp;gt; dbparams = new List&amp;lt;object&amp;gt;();
foreach (SqlParameter item in cmd.Parameters)
{
SqlParameter p = new SqlParameter(item.ParameterName, item.SqlDbType, item.Size);
p.Value = item.Value;
dbparams.Add(item.Value);
}
cmd = null;
return db.ExecuteCommand(sql, dbparams.ToArray());
}
</code></pre>

<p>&nbsp; 调用方式就很简单了，一个Lamdam表达式，就搞定。比如</p>

<pre class='green'><code>Console.Write( DataContext.test.Delete(t =&amp;gt; t.id != null||t.name.Contains("qq")&amp;amp;&amp;amp;t.Orders.OrderDate&amp;lt;=DateTime.Now));
</code></pre>

<p><a href="http://images.cnblogs.com/cnblogs_com/whitewolf/WindowsLiveWriter/Linq_138F4/image_2.png"><img src="http://images.cnblogs.com/cnblogs_com/whitewolf/WindowsLiveWriter/Linq_138F4/image_thumb.png" title="image" alt="image" /></a></p>

<p>&nbsp;</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp; 例子没有从重写Linq或者扩展Linq表达式出发，因为从这里出发我能力估计还差一筹，呵呵还是我觉得没有必要，这样的实现是否更简单，实现的功能更多些，为何不重用人家MS的东西呢，个人观点而已</p>

<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;本文通过程序<a href="https://github.com/greengerong/cnblogs-blogs2markdown" title="cnblogs-blogs2markdown">cnblogs-blogs2markdown</a>转换的,如质量有问题<a href="http://www.cnblogs.com/whitewolf/archive/2010/09/15/1826624.html" title="原文首发">原文首发请看这里</a></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/15/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/13/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>破 狼</h1>
  <p>    那一夜，我听了一宿梵唱，不为参悟，只为寻你的一丝气息。 那一月，我转过所有经轮，不为超度，只为触摸你的指纹。 那一年，我磕长头拥抱尘埃，不为朝佛，只为贴着了你的温暖。 那一世，我翻遍十万大山，不为修来世，只为路中能与你相遇。 那一瞬，我飞升成仙，不为长生，只为佑你平安喜乐。<a href="http://greengerong.github.io/blog/2009/12/24/cang-yang-jia-cuo-na-yi-tian-na-yi-yue-na-yi-nian-na-yi-shi/">《那一天，那一月，那一年，那一世》&#8211;仓央嘉措。</a></p>
</section>
<section>
  <p style="align: center"><a href="http://www.amazingcounters.com"><img border="0" src="http://cc.amazingcounters.com/counter.php?i=3158890&amp;c=9476983" alt="count web site visits"/></a></p>
</section>
<section>
    <h1>博客友情链接</h1>
    <ul>
        <li><a href="http://www.cnblogs.com/whitewolf/">博客园-破狼</a></li>
    </ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/09/08/angularzhong-huo-qu-ding-wei-yuan-su-wei-zhi-de-fa-bao/">前端获取元素定位位置的法宝</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/03/angular-inputge-shi-hua/">Angular Input格式化</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/02/angularshi-xian-di-gui-zhi-ling-tree-view/">Angular实现递归指令 - Tree View</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/30/ramdajshan-shu-bian-cheng/">Ramdajs函数编程</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/07/zhi-jie-bu-deng-yu-jian-dan/">设计-简约而不简单</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/29/swagger-qian-hou-duan-fen-chi-hou-de-qi-yue/">Swagger - 前后端分离后的契约</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/26/tsd-ti-sheng-ni-de-idedui-javascriptzhi-neng-gan-zhi-de-neng-li/">tsd-提升IDE对JavaScript智能感知的能力</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/25/tui-jian-shu-ji-yi-dong-appce-shi-de-22tiao-jun-gui/">推荐书籍 -《移动App测试的22条军规》</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/greengerong">@greengerong</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'greengerong',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - 破 狼 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'greengerong';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>











</body>
</html>
